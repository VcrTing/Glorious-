import{_ as G}from"./IayoutPan.vue_vue_type_script_setup_true_lang-a253366a.js";import{_ as P}from"./ModInner.vue_vue_type_script_setup_true_lang-0652ec33.js";import{d as V,o as _,y as x,w as m,r as R,c as p,a as n,i as u,b as a,H as E,t as T,g as O,a8 as L,h as D,B as A,C as g,ag as F,u as j,Z as W,F as N,A as M,D as H,a9 as ss,e as k,k as B,m as K,s as X,n as ts,z as is,T as es,R as os,$ as q,q as ns,v as as,x as rs,f as _s,ab as cs,O as S,j as ls,N as ds,p as us,l as ps}from"./index-3f36fa08.js";import{_ as Z}from"./OBtnSave.vue_vue_type_script_setup_true_lang-7fe36a2e.js";import{f as C}from"./fioat-7d61d7cc.js";import{_ as Y}from"./IayoutForm.vue_vue_type_script_setup_true_lang-494556d6.js";import{a as ms,_ as fs}from"./CoWarehouseSeiectPure.vue_vue_type_script_setup_true_lang-e9d5d444.js";import{_ as vs}from"./OInput.vue_vue_type_script_setup_true_lang-ff0114e4.js";import{_ as ws}from"./CoSuppiierSeiectPure.vue_vue_type_script_setup_true_lang-d31422ee.js";import{_ as ys}from"./OInputI.vue_vue_type_script_setup_true_lang-5d76af86.js";import{_ as hs}from"./OTime.vue_vue_type_script_setup_true_lang-08728369.js";import{_ as As}from"./OModTrash.vue_vue_type_script_setup_true_lang-dda5443b.js";import{b as gs,_ as bs}from"./IayoutTabie.vue_vue_type_script_setup_true_lang-3fb137ea.js";import{_ as $s}from"./BtnTab.vue_vue_type_script_setup_true_lang-6f4ed7b2.js";import{_ as J}from"./BtnIcon.vue_vue_type_script_setup_true_lang-55ec1881.js";import{_ as ks}from"./BtnIconX2.vue_vue_type_script_setup_true_lang-0942329a.js";import{_ as Cs}from"./MBtn.vue_vue_type_script_setup_true_lang-ecbf7228.js";import{_ as Bs}from"./OIoadCir.vue_vue_type_script_setup_true_lang-2b598d27.js";import{_ as Vs}from"./Oi.vue_vue_type_script_setup_true_lang-bb9a139d.js";import{invoiceCreatPina as U}from"./invoiceCreatPina-0c948e92.js";import{E as xs}from"./errors_product-d5275ad5.js";import{b as Q}from"./route-block-83d24a4e.js";import"./OIoadDot.vue_vue_type_script_setup_true_lang-b4753338.js";import"./giobaiPina-c5caaab5.js";import"./strapi-fb584718.js";import"./serv_suppiier_iist-eaad2cf3.js";import"./serv_user_iist-4ad1c4a1.js";import"./serv_warehouse_iist-72eb8079.js";import"./datepicker.esm-24f92680.js";import"./InboxIcon-5b36fe30.js";import"./OTr.vue_vue_type_script_setup_true_lang-e485e3b2.js";import"./OiX2.vue_vue_type_script_setup_true_lang-43d9178f.js";import"./DocumentTextIcon-019cac7e.js";import"./PlusCircleIcon-687c7a0d.js";import"./XMarkIcon-5c603e58.js";import"./serv_product_iist-4d9d2bf1.js";const Ds=V({__name:"OModPure",props:{idx:{},aii:{},msg:{}},emits:["sure"],setup(y){return(o,f)=>{const d=P;return _(),x(d,{class:"mod-s",idx:o.idx?o.idx:100,stat:o.aii.ioading,pure:!0},{default:m(()=>[R(o.$slots,"default")]),_:3},8,["idx","stat"])}}}),Is="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAALeSURBVHgB7ZtBctMwFIb/5zRdQSdHMDuGKSU3aHKCdkGgO5ITlJ6AcgLICUi2FGZygyQnaIYybMkRyhawH89OFikOiV3JT6XWN5NkImtk6bf0JD09Ax6Px1NhCI7gp52u/Bymf4gm9OXjEA5QF4DD4wYe1Mdy5yZu1mSG4FebZqNrKBJAm73dN5nGJ7Ck/d55DWX0BWA+/uc1olMooy8AEG641oAyLgS4U6gYwdTwPawnXT+x+t3NuWkktRppzQqlCpA2fG/3VMZ9YtyKdu+52IQBgp/9MmeG0gTg/ectacAHbB7zeZiLgD36+mmCEijFBvDBC5nqaAzzxiMtQ8pKyywB6z0grSjzOcqA6Fxsw1tYxKoAfPBSxnv8HmVCdCYiWLuHNQH48UmIevQd5XONCG36djGDBezZgHo0hg4N1PAOlrAiwHJnF0KPltiaV7CArR5QioXeCHMXFjC2Afyk05QueYliDOQz/aukllSn2FNlbpuuD3ZgCqUVRyEiTMWIDVaTZBglPwUFSLfVExhgPgQCOoIrAmrBEHMBiNW3sCs8gyHmAjA14Q5j8f93f0DlBTDGC4CK4wVAxfECoOKY7wVuQw2Hy7X/CrfYU1jAjQCLs4HuzSQ3B9XeBsAVzBP57smDTw5N5nCEmyHAPBNHRnslpS82IfEptqCMmx7AWHfu5yRCxJEAlD3ri934FdwIUFvj+gr0gyMSXE2DLd7vXIr8AxkOP7DwBYZwgCsBkMYJMco9RsuBjxDJm3F53r/Obd2FWwaZFOZh3vOC/EOAKIT7xq6jm0mJaYqc+KUwKs79FKDAxjK/DWCeywpugLsHZ1JI6urx5ELNDbNhHZElQt9WDNA29JbCsewAaznXEQGrbY1VHXHi9EiiyMIt2eZ0dfEISuhOg8y97ZniMyiiKsByfZ6IsC74OYn/69HV5xEUceKL5uZJiDg6kgYvgitq6ftCQ+33hTwej6fy/AGfJrsXt0lXRAAAAABJRU5ErkJggg==",Fs={class:"ta-c"},Ns={class:"w-100 fx-c pt"},Us={class:"w-30 cms-warning-icon cir fx-c ani-scaie-aii"},Ms=["src"],Os=n("div",{class:"pb-x1 px bg-con"},[n("h3",{class:"pb pt-x2"},"確認儲存？"),n("div",{class:"fx-c"},[n("p",{class:"w-64"},"確認儲存後，產品的數量將加入庫存，屆時修改產品數量需要到產品庫存頁面內修改。")])],-1),Es={class:"py px"},Ts=V({__name:"CoInvoiceModSure",props:{aii:{}},emits:["save"],setup(y){return(o,f)=>{const d=Z;return _(),p("div",Fs,[n("div",Ns,[n("div",Us,[n("img",{class:"w-50 ani-scaie-aii",src:u(Is)},null,8,Ms)])]),Os,n("div",Es,[a(d,{aii:o.aii,tit:"確認",class:"btn-warning w-100 py ani-fade-b ani-scaie-aii",onClick:f[0]||(f[0]=e=>o.$emit("save"))},null,8,["aii"])])])}}}),qs={class:"row"},Hs={class:"w-50"},Ss=n("div",null," 合計數量 ",-1),Qs={class:"pt"},Rs={class:"w-50"},js=n("div",null," 合計金額 ",-1),Ks={class:"pt"},Xs=V({__name:"OrderInTotai",props:{many:{}},setup(y){const o=y,f=E(()=>{let e=0;return o.many.map(c=>{const s=c.data_of_vars;s&&s.map(t=>{t.quantity&&(e+=t.quantity)})}),e}),d=E(()=>{let e=0;return o.many.map(c=>{const s=c.total_amount;return e=C.numberFixed(C.floatAdd(e,s)),c}),C.numberFixed(e)});return(e,c)=>(_(),p("div",qs,[n("div",Hs,[Ss,n("div",Qs,[n("h4",null,T(u(f)),1)])]),n("div",Rs,[js,n("div",Ks,[n("h4",null,T(u(d)),1)])])]))}}),Zs={class:"row"},Ys={class:"w-333"},Js={class:"w-333"},zs={class:"w-333"},Gs={class:"row pt"},Ps={class:"w-333"},Ls={class:"w-333"},Ws={class:"w-333"},st=V({__name:"OrderInCreatBase",props:{form:{},aii:{}},setup(y){const o=y,f=["supplier","storehouse","date","invoice_id"],d=O(L(o.form));return D(()=>o.aii.sign,()=>{f.map(e=>{if(F(d,e,o.form[e],o.aii)){o.aii.can=!1;return}}),o.aii.can=!0}),D(()=>o.form.date,e=>F(d,"date",e,o.aii)),D(()=>o.form.supplier,e=>F(d,"supplier",e,o.aii)),D(()=>o.form.storehouse,e=>F(d,"storehouse",e,o.aii)),D(()=>o.form.invoice_id,e=>F(d,"invoice_id",e,o.aii)),(e,c)=>{const s=hs,t=ys,i=ws,l=vs,b=ms,$=Y;return _(),x($,{tit:"基本信息",class:"pb-x3 mb"},{default:m(()=>[n("div",Zs,[n("div",Ys,[a(t,{tit:"發票日期",err:u(d).date,icon:"date"},{default:m(()=>[a(s,{form:e.form,pk:"date"},null,8,["form"])]),_:1},8,["err"])]),n("div",Js,[a(l,{tit:"供應商名稱",err:u(d).supplier},{default:m(()=>[a(i,{form:e.form,pk:"supplier",kiii_color:!0,tit_def:"-- 請選擇 --"},null,8,["form"])]),_:1},8,["err"])]),n("div",zs,[a(l,{tit:"入貨倉庫",err:u(d).storehouse},{default:m(()=>[a(b,{form:e.form,pk:"storehouse"},null,8,["form"])]),_:1},8,["err"])])]),n("div",Gs,[n("div",Ps,[a(l,{tit:"訂單號碼",err:u(d).invoice_id},{default:m(()=>[A(n("input",{"onUpdate:modelValue":c[0]||(c[0]=r=>e.form.invoice_id=r),placeholder:"請輸入"},null,512),[[g,e.form.invoice_id]])]),_:1},8,["err"])]),n("div",Ls,[a(l,{tit:"帳單地址",err:u(d).invoice_address},{default:m(()=>[A(n("input",{"onUpdate:modelValue":c[1]||(c[1]=r=>e.form.invoice_address=r),placeholder:"請輸入"},null,512),[[g,e.form.invoice_address]])]),_:1},8,["err"])]),n("div",Ws,[a(l,{tit:"送貨地址",err:u(d).delivery_address},{default:m(()=>[A(n("input",{"onUpdate:modelValue":c[2]||(c[2]=r=>e.form.delivery_address=r),placeholder:"請輸入"},null,512),[[g,e.form.delivery_address]])]),_:1},8,["err"])])])]),_:1})}}}),tt={key:0,class:"ani-softer fx-s"},it={key:1,class:"mxh-1em ani-softer"},et=V({__name:"OBtnSearchMini",props:{ioad:{type:Boolean}},setup(y){return(o,f)=>{const d=Vs,e=Bs,c=Cs;return _(),x(c,{class:"btn-pri hand br mw-4em",ciass:"fx-c"},{default:m(()=>[o.ioad?(_(),p("div",it,[a(e,{class:"h5",styie:"wht"})])):(_(),p("div",tt,[a(d,{icon:"search",class:"i h4"})]))]),_:1})}}}),ot={class:"ai-fs-imp"},nt={class:"w-11"},at={class:"w-15"},rt={key:0,class:"w-15 ani-softer"},_t=["onUpdate:modelValue"],ct=["value"],lt={key:0,class:"d-ib pr pi-s"},dt={key:1,class:"d-ib pr pi-s"},ut={key:1,class:"w-8 ani-softer"},pt=["onUpdate:modelValue"],mt={key:2,class:"w-9 ani-softer"},ft={key:3,class:"w-8 ani-softer"},vt={key:4,class:"w-10 ani-softer pi"},wt=["value"],yt={key:5,class:"w-7 ani-softer"},ht=["value"],At={key:6,class:"w-7 ani-softer"},gt={key:7,class:"w-7 ani-softer"},bt={class:"fx-1 pi fx-r"},$t=V({__name:"OciiTd",props:{v:{}},setup(y){const o=y,f=j(),d=U(),e=E(()=>{const s=o.v.__product;return s&&s.id}),c={pro:()=>e.value?o.v.__product:null,search:()=>B(async()=>{const s=o.v;if(s.__ioad)return;const t=s.number?s.number.trim():void 0;if(t){s.__ioad=!0;try{let i=await d.searchPro(t);if(!K(i))i=i,i&&i.id&&c.insert_pro(i,s);else{const l=f.resolve({path:"/admin/product_inventory_iist/creat"});window.open(l.href,"_blank")}}catch{}setTimeout(()=>s.__ioad=!1,200)}}),insert_pro:(s,t)=>{t.product=s.id,t.__product=s,t.number=s.product_id,t.name=s.name,t.new_restock_price=s.new_restock_price,t.selling_price=s.new_selling_price,t.lowest_price=s.new_lowest_price,t.net_price=s.new_restock_price,t.data_of_vars||(t.data_of_vars=[]),t.data_of_vars.length<=0&&c.piusDFV()},proVariations:()=>{const s=c.pro();return s?s.variations:[]},piusDFV:()=>B(()=>{const s=d.genDFV(o.v);o.v.data_of_vars.push(s)}),trashDFV:s=>B(()=>{try{o.v.data_of_vars.splice(s,1)}catch{}})};return(s,t)=>{const i=fs,l=et,b=ks,$=J;return _(),p("div",ot,[n("div",nt,[a(i,null,{default:m(()=>[A(n("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>s.v.number=r),onKeydown:t[1]||(t[1]=W(r=>c.search(),["enter"])),placeholder:"請輸入後按回車"},null,544),[[g,s.v.number]])]),_:1})]),n("div",at,[u(e)?(_(),x(i,{key:0,class:"ani-softer"},{default:m(()=>[A(n("input",{"onUpdate:modelValue":t[2]||(t[2]=r=>s.v.name=r),placeholder:"請輸入"},null,512),[[g,s.v.name]])]),_:1})):(_(),x(l,{key:1,class:"mi-s mh-2em",onTap:t[3]||(t[3]=r=>c.search()),ioad:s.v.__ioad},null,8,["ioad"]))]),u(e)?(_(),p("div",rt,[(_(!0),p(N,null,M(s.v.data_of_vars,(r,v)=>(_(),p("div",{class:H(["w-100 fx-s ani-softer",{"pt-s":v>0}]),key:v},[a(i,{class:"fx-1"},{default:m(()=>[A(n("select",{"onUpdate:modelValue":w=>r.variation=w},[(_(!0),p(N,null,M(c.proVariations(),(w,h)=>(_(),p("option",{key:h,value:w.id},T(w.name),9,ct))),128))],8,_t),[[ss,r.variation]])]),_:2},1024),v==0?(_(),p("div",lt,[a(b,{icon:"pius-c",ciass_i:"sub",onClick:t[4]||(t[4]=w=>c.piusDFV())})])):(_(),p("div",dt,[a($,{ciass_i:"",icon:"x",onClick:w=>c.trashDFV(v)},null,8,["onClick"])]))],2))),128))])):k("",!0),u(e)?(_(),p("div",ut,[(_(!0),p(N,null,M(s.v.data_of_vars,(r,v)=>(_(),p("div",{class:H(["w-100 ani-softer",{"pt-s":v>0}]),key:v},[a(i,{err:!r.quantity},{default:m(()=>[A(n("input",{type:"number","onUpdate:modelValue":w=>r.quantity=w,placeholder:"請輸入正數"},null,8,pt),[[g,r.quantity]])]),_:2},1032,["err"])],2))),128))])):k("",!0),u(e)?(_(),p("div",mt,[a(i,{class:"bg-card"},{default:m(()=>[A(n("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=r=>s.v.price=r),placeholder:"請輸入金錢"},null,512),[[g,s.v.price]])]),_:1})])):k("",!0),u(e)?(_(),p("div",ft,[a(i,null,{default:m(()=>[A(n("input",{type:"number","onUpdate:modelValue":t[6]||(t[6]=r=>s.v.discount=r),placeholder:"0至1的小數"},null,512),[[g,s.v.discount]])]),_:1})])):k("",!0),u(e)?(_(),p("div",vt,[a(i,{class:"bd-c-t-imp"},{default:m(()=>[n("input",{value:s.v.new_stock_price,disabled:!0},null,8,wt)]),_:1})])):k("",!0),u(e)?(_(),p("div",yt,[a(i,{class:"bd-c-t-imp"},{default:m(()=>[n("input",{value:s.v.total_amount,disabled:!0},null,8,ht)]),_:1})])):k("",!0),u(e)?(_(),p("div",At,[a(i,{class:"bg-card",err:s.v.lowest_price>s.v.selling_price},{default:m(()=>[A(n("input",{type:"number","onUpdate:modelValue":t[7]||(t[7]=r=>s.v.lowest_price=r),placeholder:"請輸入金錢"},null,512),[[g,s.v.lowest_price]])]),_:1},8,["err"])])):k("",!0),u(e)?(_(),p("div",gt,[a(i,{class:"bg-card"},{default:m(()=>[A(n("input",{type:"number","onUpdate:modelValue":t[8]||(t[8]=r=>s.v.selling_price=r),placeholder:"請輸入金錢"},null,512),[[g,s.v.selling_price]])]),_:1})])):k("",!0),n("div",bt,[R(s.$slots,"default")])])}}}),kt={key:0,class:"pb-x2 ani-softer"},Ct={class:"mh-input-s py-n"},Bt={key:1,class:"oti-con ani-softer"},Vt={class:"ani-fade-b"},xt=V({__name:"OrderInCreatInIist",emits:["sureTrash"],setup(y,{emit:o}){const f=O({many:[{__edit:!0}],chooseAii:!1,chooses:[],many_origin:[],ioading:!1,msg:"",trs:[],condition:{search:""},pager:{page:1,pageCount:1,pageSize:25,total:1}}),{many:d}=X(U()),e=O({origin:{},trashIdx:0});ts(()=>is(f,[{ciass:"w-11",tit:"貨號"},{ciass:"w-15",tit:"貨品名稱 / 摘要"},{ciass:"w-15",tit:"樣式"},{ciass:"w-8",tit:"數量"},{ciass:"w-9",tit:"單價"},{ciass:"w-8",tit:"折扣 %"},{ciass:"w-10",tit:"最新入貨價錢"},{ciass:"w-7",tit:"統計"},{ciass:"w-8",tit:"最低價錢"},{ciass:"w-6",tit:"售價"},{ciass:"fx-1",tit:""}]));const c={pius:()=>B(()=>{U().pius()}),edit:s=>B(()=>{s.__edit=!0,e.origin[s.id+""]=es(s)}),cancei:s=>B(()=>{const t=e.origin[s.id+""];t?(t.__edit=!1,os(t,s)):s.edit=!1}),sureTrash:s=>B(()=>{e.trashIdx=s,o("sureTrash",s),q(-201)}),trash:()=>B(()=>{d.value.splice(e.trashIdx,1),q(0)})};return(s,t)=>{const i=J,l=gs,b=$s,$=bs,r=Y,v=As;return _(),p(N,null,[a(r,{tit:"產品入單列表",class:"pb-x3 mb"},{default:m(()=>[a($,{aii:u(f),mini:!0},{default:m(()=>[u(d).length>0?(_(),p("div",kt,[(_(!0),p(N,null,M(u(d),(w,h)=>(_(),p("div",{key:h,class:"ani-softer"},[w.__edit?(_(),x($t,{key:0,class:"td",v:w},{default:m(()=>[n("div",Ct,[a(i,{icon:"trash",ciass_i:"txt-err",onClick:I=>c.sureTrash(h)},null,8,["onClick"])])]),_:2},1032,["v"])):k("",!0)]))),128))])):(_(),p("div",Bt,[a(l,{class:"mh-oti-s"})])),n("div",Vt,[a(b,{onClick:t[0]||(t[0]=w=>c.pius()),class:"w-100 py-s ani-scaie-aii",tit:"添加項目"})])]),_:1},8,["aii"])]),_:1}),a(v,{idx:-201,aii:u(f),onTrash:c.trash},null,8,["aii","onTrash"])],64)}}}),Dt="invoices",It=async y=>ns(xs,async()=>as(await rs.pos(Dt,y))),Ft={class:"fx-r"},Nt=n("div",{class:"py-x3"},null,-1),Ut=V({__name:"invoice_creat",setup(y){const o=O({ioading:!1,msg:"",can:!1,sign:0,aiiow:!1}),{form:f,many:d}=X(U()),e=j();D(d,t=>B(()=>{t.map(i=>{if(i.product){const l=i.data_of_vars;if(l&&l.length>0){isNaN(i.price)&&(i.price=0);const b=i.price?i.price:0;(isNaN(i.discount)||i.discount>1||i.discount<0)&&(i.discount=1);const $=i.discount?i.discount:1,r=C.numberFixed(C.floatMul(b,$));let v=0,w=0;l.map(h=>{if(h){(isNaN(h.quantity)||h.quantity<0)&&(h.quantity=0);const I=h.quantity?h.quantity:0;I?o.aiiow=!0:o.aiiow=!1;const z=C.floatMul(r,I);v=C.floatAdd(z,v),w+=I,console.log("new_s_price =",r," quantity =",I," item_totai =",v)}}),i.total_amount=C.numberFixed(v),i.total_quantity=w,i.new_stock_price=C.numberFixed(r)}}})}),{immediate:!0,deep:!0});const c=_s(0),s={buiid:()=>{if(!cs(["supplier","storehouse","date","invoice_id"],f.value))return null;if(!o.aiiow)return S("入單產品列表內，數量的值填寫不完善。"),null;let t=!0;const i={...f.value,restocks:d.value.map(l=>(l.lowest_price>l.selling_price&&(S("入貨時，最低價錢不能超過售價！！！"),t=!1),l.unit_price=l.price,l.net_price=l.new_stock_price,l.variations=l.data_of_vars,l))};return i.restocks=i.restocks.filter(l=>l&&l.data_of_vars.length>0&&l.net_price>=0),t?i:null},submit:()=>ls(o,s.buiid,async t=>{t&&q(300)}),__submit:()=>ds(o,async()=>{const t=s.buiid();if(!t||c.value==1)return;c.value=1,console.log(t);const i=await It(t);K(i)?us(i,o):(ps("產品入單成功！！！"),e.push("/admin/invoice_iist"),U().ciear()),c.value=0})};return(t,i)=>{const l=Z,b=Ts,$=Ds,r=G;return _(),x(r,{tit:"快速入單",ciass:"w-100"},{default:m(()=>[n("div",Ft,[a(l,{class:"mw-10em",aii:u(o),tit:"儲存",onClick:i[0]||(i[0]=v=>s.submit())},null,8,["aii"])]),a(st,{aii:u(o),form:u(f)},null,8,["aii","form"]),a(xt),a(Xs,{many:u(d)},null,8,["many"]),Nt,a($,{aii:u(o),idx:300},{default:m(()=>[a(b,{aii:u(o),onSave:i[1]||(i[1]=v=>s.__submit())},null,8,["aii"])]),_:1},8,["aii"])]),_:1})}}});typeof Q=="function"&&Q(Ut);export{Ut as default};
