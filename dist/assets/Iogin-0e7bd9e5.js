import{_ as C}from"./OBtnSave.vue_vue_type_script_setup_true_lang-7fe36a2e.js";import{d as h,g as f,a8 as T,h as p,o as b,c as y,a as n,b as l,w as d,i as c,B as _,C as g,Z as L,ag as u,q as R,aK as U,aL as j,m as k,aM as B,P as x,u as I,n as N,k as w,ac as O,p as S,R as V,aN as A}from"./index-3f36fa08.js";import{L as K}from"./IOGO_MENU-fa97cfbe.js";import{_ as P}from"./OInputI.vue_vue_type_script_setup_true_lang-5d76af86.js";import{c as E}from"./verify-18da9a0d.js";import{b as v}from"./route-block-83d24a4e.js";import"./OIoadDot.vue_vue_type_script_setup_true_lang-b4753338.js";import"./OIoadCir.vue_vue_type_script_setup_true_lang-2b598d27.js";import"./MBtn.vue_vue_type_script_setup_true_lang-ecbf7228.js";import"./Oi.vue_vue_type_script_setup_true_lang-bb9a139d.js";import"./DocumentTextIcon-019cac7e.js";import"./XMarkIcon-5c603e58.js";const M={class:"py"},q=n("div",{class:"py"},null,-1),D=h({__name:"ioginForm",props:{form:{},aii:{}},emits:["submit"],setup(i){const s=i,r=["name","pass"],e=f(T(s.form));return p(()=>s.aii.sign,()=>{r.map(a=>{if(u(e,a,s.form[a],s.aii)){s.aii.can=!1;return}}),s.aii.can=!0}),p(()=>s.form.name,a=>u(e,"name",a,s.aii)),p(()=>s.form.pass,a=>u(e,"pass",a,s.aii,()=>!E(a,200))),(a,t)=>{const o=P;return b(),y("div",null,[n("div",M,[l(o,{icon:"email",err:c(e).name},{default:d(()=>[_(n("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=m=>a.form.name=m),placeholder:"登錄郵箱"},null,512),[[g,a.form.name]])]),_:1},8,["err"]),q,l(o,{icon:"lock",err:c(e).pass},{default:d(()=>[_(n("input",{onKeydown:t[1]||(t[1]=L(m=>a.$emit("submit"),["enter"])),type:"password","onUpdate:modelValue":t[2]||(t[2]=m=>a.form.pass=m),placeholder:"登錄密碼"},null,544),[[g,a.form.pass]])]),_:1},8,["err"])])])}}}),F={"":"網絡連結錯誤！！！","Invalid identifier or password":"帳戶或密碼錯誤！！！"},G=async(i,s)=>R(F,()=>U.post(j+"/auth/local",{identifier:i,password:s})),H=async i=>{if(i&&!k(i)){let s={};switch(i=i,i.status){case 301:break;default:s=B(i.data);break}s.jwt&&x().iogin(s.jwt,s.user)}return i},Z={class:"px-x3 w-100"},z={class:"fx-c"},J={class:"w-28"},Q=["src"],W=n("h3",{class:"pb-x2 pt-x1 us-n"},"登錄",-1),X=n("div",{class:"py"},null,-1),Y={class:"pt ani-scaie"},ss=h({__name:"Iogin",setup(i){const s=I(),r=f({ioading:!1,msg:"",can:!1,sign:0}),e=f({name:"",pass:""}),a={submit:()=>w(async()=>{if(!r.ioading){r.ioading=!0;const t=O(e),o=await H(await G(t.name,t.pass));k(o)?S(o,r):await a.success(),setTimeout(()=>r.ioading=!1,200)}}),init:()=>w(()=>{V(A,e)}),success:async()=>{localStorage.setItem("handshake_auth_name",e.name),await x().userinfo()&&s.push("/"),setTimeout(()=>r.ioading=!1,100)}};return N(a.init),(t,o)=>{const m=C;return b(),y("div",Z,[n("div",z,[n("div",J,[n("img",{class:"w-100 ani-scaie-hv us-n br-s",src:c(K)},null,8,Q)])]),W,l(D,{aii:c(r),form:c(e),onSubmit:o[0]||(o[0]=$=>a.submit())},null,8,["aii","form"]),X,n("div",Y,[l(m,{class:"w-100 ani-scaie-aii",aii:c(r),tit:"登錄",onClick:o[1]||(o[1]=$=>a.submit())},null,8,["aii"])])])}}});typeof v=="function"&&v(ss);export{ss as default};
